<!DOCTYPE html>
<html lang="de" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    
    <title>KBD Insights | Präferenzen verwalten</title>
    <meta name="description" content="Verwalten Sie Ihre Einstellungen für die KBD Insights.">
    
    <meta name="robots" content="noindex, nofollow">
    <link rel="canonical" href="https://www.kassel-bd.de/unsubscribe.html">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#071F36">

    <link rel="stylesheet" href="css/design-system.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <script src="config.js"></script>
    <script src="js/components.js" defer></script>
    <script src="js/button-animation.js" defer></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        kbdBlue: '#071F36',
                        richGrey: '#2D3748',
                        softGrey: '#4A5563',
                        lightGrey: '#F3F5F7',
                        bracketBlue: '#071F36'
                    }
                }
            }
        }
    </script>

    <style>
        /* Fonts loaded globally via design-system.css */

        /* --- GLOBAL VARIABLES --- */
        :root {
            --kbd-blue: #071F36;
            --rich-grey: #2D3748;
            --soft-grey: #4A5563;
            --white: #FFFFFF;
            --bracket-blue: #071F36;
        }

        body {
            background-color: var(--white);
            color: var(--rich-grey);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            line-height: 1.6;
        }

        /* TYPOGRAPHY */
        h1, h2, h3, h4, h5, h6 { color: var(--kbd-blue); letter-spacing: -0.01em; line-height: 1.15; }
        h1 { font-weight: 700; } h2 { font-weight: 700; } h3 { font-weight: 700; /* Changed from 600 */ }

        .eyebrow {
            font-family: 'Inter', sans-serif; font-weight: 500; letter-spacing: 0.02em;
            text-transform: uppercase; color: var(--soft-grey); font-size: 12px;
        }

        /* Buttons: global via design-system.css */

        /* HEADER SCROLL STATE */
        .nav-scrolled { background-color: rgba(255, 255, 255, 0.98); backdrop-filter: blur(12px); box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.05); }

        /* FORM SPECIFIC */
        .form-input {
            border-bottom-width: 1px;
            border-color: #E1E5E9;
            background-color: transparent;
            transition: border-color 0.2s;
        }
        .form-input:focus {
            border-color: #071F36;
            outline: none;
        }
        input[type="checkbox"], input[type="radio"] {
            accent-color: #071F36;
            cursor: pointer;
        }
        input[type="radio"] { width: 1.25em; height: 1.25em; border: 1px solid #D1D5DB; }
        input[type="radio"]:checked { border-color: #071F36; background-color: #071F36; }
        .hp-hidden { display: none !important; visibility: hidden !important; }
    </style>
</head>

<body class="flex flex-col min-h-screen">

    <nav id="navbar" class="fixed top-0 left-0 w-full z-50 transition-all duration-300 nav-scrolled bg-white">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20 transition-all duration-300" id="nav-container">
                
                <div class="flex items-center gap-3 z-50">
                    <a href="index.html" class="block relative group" aria-label="Zur Startseite">
                        <img src="icon.png" alt="KBD Logo" id="nav-logo" width="56" height="56" class="h-10 md:h-12 w-auto object-contain transition-all duration-300" />
                    </a>
                </div>

                <div class="hidden lg:flex items-center space-x-8 text-[15px] font-medium tracking-wide text-[#071F36]" id="nav-links">
                    <a href="ueberuns.html" class="nav-item relative py-2 hover:opacity-80 transition-opacity">Über Uns</a>
                    <a href="leistungen.html" class="nav-item relative py-2 hover:opacity-80 transition-opacity">Leistungen</a>
                    <a href="technologie.html" class="nav-item relative py-2 hover:opacity-80 transition-opacity">Technologie</a>
                    <a href="erfolge.html" class="nav-item relative py-2 hover:opacity-80 transition-opacity">Erfolge</a>                    
                    <!-- Expertise Dropdown -->
                    <div class="nav-dropdown">
                        <span class="nav-dropdown-trigger nav-item relative py-2 hover:opacity-80 transition-opacity"
                              tabindex="0"
                              role="button"
                              aria-expanded="false"
                              aria-haspopup="true">
                            Expertise
                            <i data-lucide="chevron-down" class="nav-dropdown-icon"></i>
                        </span>
                        <div class="nav-dropdown-menu" role="menu">
                            <a href="versicherungsmakler.html" class="nav-dropdown-item" role="menuitem">Versicherungsmakler</a>
                        </div>
                    </div>
                    <a href="publikationen/index.html" class="nav-item relative py-2 hover:opacity-80 transition-opacity">Publikationen</a>
                    
                    <button type="button" onclick="openContactModal(event)" class="btn-primary ml-2 border-white/10 !py-2 !px-5 !text-[14px]">
                        Kontakt
                    </button>
                </div>

                <button type="button" class="lg:hidden text-[#071F36] p-2 -mr-2 transition-colors duration-300 focus:outline-none" id="menu-btn" onclick="toggleMobileMenu()" aria-label="Menu öffnen">
                    <i data-lucide="menu" class="w-7 h-7"></i>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="hidden absolute top-full left-0 w-full bg-white shadow-2xl border-t border-gray-100 transform origin-top transition-all duration-300 ease-in-out z-40">
            <div class="flex flex-col px-6 py-8 space-y-6 font-medium text-[#071F36]">
                <a href="ueberuns.html" class="block text-lg border-b border-gray-100 pb-4">Über Uns</a>
                <a href="leistungen.html" class="block text-lg border-b border-gray-100 pb-4">Leistungen</a>
                <a href="technologie.html" class="block text-lg border-b border-gray-100 pb-4">Technologie</a>
                <a href="erfolge.html" class="block text-lg border-b border-gray-100 pb-4">Erfolge</a>                
                <!-- Expertise Mobile Dropdown -->
                <div class="border-b border-gray-100 pb-4">
                    <div class="mobile-dropdown-trigger text-lg flex justify-between items-center"
                         onclick="toggleMobileDropdown('mobile-expertise-dropdown')">
                        <span>Expertise</span>
                        <i data-lucide="chevron-down" class="mobile-dropdown-icon w-5 h-5" style="transition: transform 0.3s ease;"></i>
                    </div>
                    <div id="mobile-expertise-dropdown" class="mobile-dropdown-content">
                        <a href="versicherungsmakler.html" class="mobile-dropdown-item block py-3 pl-8 text-[#4A5563] hover:text-[#071F36]">
                            Versicherungsmakler
                        </a>
                    </div>
                </div>
                <a href="publikationen/index.html" class="block text-lg border-b border-gray-100 pb-4">Publikationen</a>
                <a href="karriere.html" class="block text-lg border-b border-gray-100 pb-4">Karriere</a>
                
                <button type="button" onclick="openContactModal(event)" class="w-full text-left text-lg font-bold text-[#071F36] pt-2">
                    Kontakt
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-grow pt-32 pb-20">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="max-w-3xl">
                
                <div class="mb-12 text-left">
                    <span class="eyebrow block mb-3">KBD Insights</span>
                    <h1 class="text-[#071F36] text-4xl sm:text-5xl font-bold tracking-tight mb-6">
                        Präferenzen verwalten
                    </h1>
                    <p class="text-[#2D3748] text-lg leading-[1.6] max-w-2xl">
                        Wir setzen auf Qualität statt Quantität. Wenn unsere Insights für Ihre aktuelle strategische Ausrichtung nicht mehr relevant sind, können Sie Ihr Abonnement hier mit einem Klick beenden.
                    </p>
                </div>

                <div class="mt-8">
                    
                    <div id="confirm-box" class="bg-[#F3F5F7] p-8 md:p-12 border border-[#E1E5E9]">
                        <div class="flex items-start gap-4 mb-6">
                            <div class="w-10 h-10 shrink-0 bg-[#071F36] flex items-center justify-center">
                                <i data-lucide="bell-off" class="text-white w-5 h-5"></i>
                            </div>
                            <div>
                                <h3 class="text-[#071F36] text-xl font-bold mb-2">Abonnement beenden?</h3>
                                <p class="text-[#4A5563] text-base leading-relaxed">
                                    Sie werden aus dem Verteiler für <strong>KBD Insights</strong> entfernt. Sie erhalten künftig keine Analysen zur Prozessautomatisierung mehr.
                                </p>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-4 mt-8 pt-8 border-t border-[#D1D5DB]">
                            <a href="index.html" class="btn-primary w-full sm:w-auto">
                                Abbrechen & Zurück
                            </a>

                            <button onclick="confirmUnsubscribe()" id="submit-btn" class="btn-secondary w-full sm:w-auto">
                                <span id="btn-text">Abmeldung bestätigen</span>
                                <span id="btn-loading" class="hidden flex items-center gap-2">
                                    <svg class="animate-spin h-4 w-4 text-[#071F36]" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                    Verarbeite...
                                </span>
                            </button>
                        </div>
                    </div>

                    <div id="success-message" class="hidden bg-[#F3F5F7] p-8 md:p-12 border border-[#E1E5E9]">
                         <div class="flex flex-col items-start text-left space-y-6">
                            <div class="w-12 h-12 bg-[#2ECC71] flex items-center justify-center">
                                <i data-lucide="check" class="text-white w-6 h-6"></i>
                            </div>
                            <h2 class="text-[#071F36] text-2xl font-bold tracking-tight">Einstellungen gespeichert</h2>
                            <p class="text-[#2D3748] text-lg leading-relaxed max-w-xl">
                                Ihre E-Mail-Adresse wurde erfolgreich aus unserem Verteiler entfernt. Wir bedanken uns für Ihr Interesse in der Vergangenheit.
                            </p>
                            <a href="index.html" class="mt-4 text-[#071F36] font-medium underline hover:text-[#0A2A4A] transition-colors flex items-center gap-2">
                                <i data-lucide="arrow-left" class="w-4 h-4"></i> Zurück zur Startseite
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <footer id="footer" class="bg-white text-[#071F36] border-t border-[#E1E5E9] font-inter mt-auto relative z-10">
        <div class="max-w-7xl mx-auto px-6 lg:px-8 py-16 lg:py-24">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-12 lg:gap-8 mb-20 items-start">
                
                <div class="lg:col-span-3 flex flex-col items-start">
                    <a href="index.html" class="block mb-8 group" aria-label="Zur Startseite">
                        <img src="icon.png" alt="KBD Logo" width="56" height="56" class="h-12 md:h-14 w-auto object-contain opacity-90 group-hover:opacity-100 transition-opacity" />
                    </a>
                    <p class="text-[#4A5563] text-sm leading-relaxed max-w-md mb-8">
                        Intelligente Systemarchitekturen für den Mittelstand. Erprobte Blaupausen, individuell angepasst. Von angehenden Wirtschaftsinformatikern gebaut.</p>
                    <div class="flex items-center gap-6">
                        <a href="https://www.linkedin.com/company/kassel-bd" target="_blank" class="text-[#9CA3AF] hover:text-[#071F36] transition-all hover:-translate-y-1" aria-label="KBD auf LinkedIn"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                        <a href="https://www.instagram.com/kassel_bd/" target="_blank" class="text-[#9CA3AF] hover:text-[#071F36] transition-all hover:-translate-y-1" aria-label="KBD auf Instagram"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <h4 class="text-xs font-semibold tracking-widest uppercase text-[#9CA3AF] mb-6">Unternehmen</h4>
                    <ul class="space-y-3 text-[#2D3748] text-sm">
                        <li><a href="ueberuns.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Über Uns</a></li>
                        <li><a href="karriere.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Karriere</a></li>
                        <li><a href="partner.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Partner</a></li>
                        <li><a href="kontakt.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Kontakt</a></li>
                    </ul>
                </div>

                <div class="lg:col-span-2">
                    <h4 class="text-xs font-semibold tracking-widest uppercase text-[#9CA3AF] mb-6">Expertise</h4>
                    <ul class="space-y-3 text-[#2D3748] text-sm">
                        <li><a href="leistungen.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Leistungen</a></li>
                        <li><a href="technologie.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Technologie</a></li>
                        <li><a href="erfolge.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Erfolge</a></li>
                                <li><a href="versicherungsmakler.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Versicherungsmakler</a></li>
                        <li><a href="publikationen/index.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Publikationen</a></li>
                    </ul>
                </div>

                <div class="lg:col-span-2">
                    <h4 class="text-xs font-semibold tracking-widest uppercase text-[#9CA3AF] mb-6">Werte & Recht</h4>
                    <ul class="space-y-3 text-[#2D3748] text-sm">
                        <li><a href="verantwortung.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Verantwortung</a></li>
                        <li><a href="impressum.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Impressum</a></li>
                        <li><a href="datenschutz.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Datenschutz</a></li>
                        <li><a href="trust-center.html" class="hover:text-[#071F36] hover:underline decoration-1 underline-offset-4 transition-all">Trust Center</a></li>
                    </ul>
                </div>

                <div class="lg:col-span-3">
                    <h4 class="text-xs font-semibold tracking-widest uppercase text-[#9CA3AF] mb-6">Insights</h4>
                    <p class="text-[#4A5563] text-xs mb-4 leading-relaxed max-w-xs">Exklusive Marktanalysen und strategische Impulse. Substanz für Ihre Entscheidungen.</p>
                    <button onclick="openNewsletterModal(event)" class="btn-primary w-full max-w-xs !py-3">Anmelden</button>
                </div>
            </div>

            <div class="border-t border-[#E1E5E9] pt-8 flex flex-col md:flex-row justify-between items-center text-[#9CA3AF] text-xs">
                <p>&copy; 2025 Kassel Business Digital.</p>
                <p class="mt-2 md:mt-0 font-medium">Intelligente Systeme für alle.</p>
            </div>
        </div>
    </footer>

    <div id="contact-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-[#071F36]/90 backdrop-blur-sm transition-opacity opacity-0" id="contact-backdrop" onclick="closeContactModal()"></div>
        <div class="relative bg-white w-full max-w-2xl shadow-2xl transform transition-all scale-95 opacity-0 translate-y-4 flex flex-col max-h-[90vh]" id="contact-content">
            <div class="p-4 border-b border-[#E1E5E9] flex justify-between items-center bg-[#F3F5F7] shrink-0">
                <span class="text-xs font-bold uppercase text-[#071F36] tracking-wider ml-2">Kontakt aufnehmen</span>
                <button onclick="closeContactModal()" class="text-[#4A5563] hover:text-[#071F36] transition-colors p-2 hover:bg-[#E1E5E9]">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto bg-white">
                <div id="contact-success" class="hidden flex flex-col items-center justify-center py-12 text-center h-full">
                    <div class="w-16 h-16 bg-[#071F36] flex items-center justify-center mb-6 rounded-full">
                        <i data-lucide="check" class="text-white w-8 h-8"></i>
                    </div>
                    <h2 class="text-[#071F36] text-2xl font-bold tracking-tight mb-4">Vielen Dank</h2>
                    <p class="text-[#2D3748] text-base leading-relaxed max-w-md">
                        Ihre Anfrage wurde erfolgreich übermittelt. Ein Berater wird sich in Kürze bei Ihnen melden.
                    </p>
                    <button onclick="closeContactModal()" class="mt-8 btn-primary">
                        Schließen
                    </button>
                </div>

                <div id="contact-form-container">
                    <form id="contact-form" onsubmit="handleContactFormSubmit(event)" class="space-y-6">
                        <div class="hp-hidden">
                            <input type="text" name="b_address" tabindex="-1" value="" autocomplete="off">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-1">
                                <label for="firstname" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Vorname *</label>
                                <input type="text" name="firstname" id="firstname" required class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent" placeholder="Max" />
                            </div>
                            <div class="space-y-1">
                                <label for="lastname" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Nachname *</label>
                                <input type="text" name="lastname" id="lastname" required class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent" placeholder="Mustermann" />
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-1">
                                <label for="email" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">E-Mail *</label>
                                <input type="email" name="email" id="email" required class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent" placeholder="max@unternehmen.de" />
                            </div>
                            <div class="space-y-1">
                                <label for="phone" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Telefon</label>
                                <input type="tel" name="phone" id="phone" class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent" placeholder="+49 123 456789" />
                            </div>
                        </div>

                        <div class="space-y-1">
                            <label for="company" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Unternehmen</label>
                            <input type="text" name="company" id="company" class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent" placeholder="Firma GmbH" />
                        </div>

                        <div class="space-y-3 pt-2">
                            <label class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Ihr Thema *</label>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <label class="flex items-center space-x-3 cursor-pointer group p-2 -ml-2 rounded hover:bg-[#F3F5F7] transition-colors">
                                    <input type="radio" name="topic" value="beratung" class="form-radio text-[#071F36] focus:ring-[#071F36]" required>
                                    <span class="text-[#2D3748] text-sm font-medium group-hover:text-[#071F36]">Beratung</span>
                                </label>
                                <label class="flex items-center space-x-3 cursor-pointer group p-2 -ml-2 rounded hover:bg-[#F3F5F7] transition-colors">
                                    <input type="radio" name="topic" value="karriere" class="form-radio text-[#071F36] focus:ring-[#071F36]">
                                    <span class="text-[#2D3748] text-sm font-medium group-hover:text-[#071F36]">Karriere</span>
                                </label>
                                <label class="flex items-center space-x-3 cursor-pointer group p-2 -ml-2 rounded hover:bg-[#F3F5F7] transition-colors">
                                    <input type="radio" name="topic" value="partner" class="form-radio text-[#071F36] focus:ring-[#071F36]">
                                    <span class="text-[#2D3748] text-sm font-medium group-hover:text-[#071F36]">Partnerkooperation</span>
                                </label>
                                <label class="flex items-center space-x-3 cursor-pointer group p-2 -ml-2 rounded hover:bg-[#F3F5F7] transition-colors">
                                    <input type="radio" name="topic" value="sonstige" class="form-radio text-[#071F36] focus:ring-[#071F36]">
                                    <span class="text-[#2D3748] text-sm font-medium group-hover:text-[#071F36]">Sonstiges</span>
                                </label>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label for="message" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Nachricht</label>
                            <textarea name="message" id="message" rows="3" class="block w-full border border-[#E1E5E9] p-3 text-[#2D3748] placeholder-[#A0AEC0] focus:border-[#071F36] focus:outline-none transition-colors bg-[#F3F5F7] resize-none text-sm" placeholder="Wie können wir Sie unterstützen?"></textarea>
                        </div>

                        <div class="flex items-start">
                            <input id="contact-consent" name="consent" type="checkbox" required class="mt-1 h-4 w-4 border-gray-300 text-[#071F36] focus:ring-[#071F36] rounded-none cursor-pointer" />
                            <label for="contact-consent" class="ml-3 text-xs text-[#4A5563] leading-snug">
                                Ich stimme der Verarbeitung meiner Daten gemäß der <a href="datenschutz.html" target="_blank" class="underline hover:text-[#071F36]">Datenschutzerklärung</a> zu.
                            </label>
                        </div>

                        <button type="submit" id="contact-submit-btn" class="btn-primary w-full">
                            <span id="contact-btn-text">Anfrage absenden</span>
                            <span id="contact-btn-loading" class="hidden flex items-center">
                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                Wird gesendet...
                            </span>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="newsletter-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-[#071F36]/90 backdrop-blur-sm transition-opacity opacity-0" id="newsletter-backdrop" onclick="closeNewsletterModal()"></div>
        
        <div class="relative bg-white w-full max-w-md shadow-2xl transform transition-all scale-95 opacity-0 translate-y-4 flex flex-col" id="newsletter-content">
            
            <div class="p-8 pb-0 flex justify-between items-start">
                <div class="flex flex-col">
                    <span class="text-xs font-bold uppercase text-[#071F36] tracking-wider mb-2">KBD Insights</span>
                    <h3 class="text-2xl font-bold text-[#071F36] leading-tight">Exklusives Update</h3>
                </div>
                <button onclick="closeNewsletterModal()" class="text-[#4A5563] hover:text-[#071F36] transition-colors p-1 hover:bg-[#F3F5F7] -mr-2 -mt-2">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="p-8 pt-6">
                <div id="newsletter-success" class="hidden flex flex-col items-center justify-center py-8 text-center">
                    <div class="w-12 h-12 bg-[#F3F5F7] flex items-center justify-center mb-4 rounded-none">
                        <i data-lucide="check" class="text-[#071F36] w-6 h-6"></i>
                    </div>
                    <h4 class="text-lg font-bold text-[#071F36] mb-2">Anmeldung erfolgreich</h4>
                    <p class="text-[#4A5563] text-sm">Bitte prüfen Sie Ihren Posteingang zur Bestätigung.</p>
                    <button onclick="closeNewsletterModal()" class="mt-6 text-sm underline text-[#071F36]">Schließen</button>
                </div>

                <form id="newsletter-form" onsubmit="handleNewsletterSubmit(event)" class="space-y-6">
                    <p class="text-sm text-[#4A5563] leading-relaxed">
                        Erhalten Sie kuratierte Einblicke in Prozessarchitektur und Automatisierung. Kein Spam, nur Substanz.
                    </p>

                    <div class="space-y-1">
                        <label htmlFor="nl-firstname" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Vorname *</label>
                        <input type="text" id="nl-firstname" name="firstname" class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent text-base focus:border-[#071F36] transition-colors" placeholder="Max" required>
                    </div>

                    <div class="space-y-1">
                        <label htmlFor="nl-lastname" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">Nachname *</label>
                        <input type="text" id="nl-lastname" name="lastname" class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent text-base focus:border-[#071F36] transition-colors" placeholder="Mustermann" required>
                    </div>

                    <div class="space-y-1">
                        <label htmlFor="nl-email" class="block text-[#4A5563] text-xs font-medium tracking-wide uppercase">E-Mail *</label>
                        <input type="email" id="nl-email" name="email" class="block w-full border-b border-[#E1E5E9] py-2 text-[#2D3748] placeholder-[#A0AEC0] form-input bg-transparent text-base focus:border-[#071F36] transition-colors" placeholder="max@unternehmen.de" required>
                    </div>

                    <div class="flex items-start pt-2">
                        <input id="nl-consent" name="consent" type="checkbox" required class="mt-1 h-4 w-4 border-gray-300 text-[#071F36] focus:ring-[#071F36] rounded-none cursor-pointer accent-[#071F36]">
                        <label htmlFor="nl-consent" class="ml-3 text-xs text-[#4A5563] leading-snug">
                            Ich stimme der Verarbeitung meiner Daten gemäß der <a href="https://kassel-bd.de/datenschutz.html" class="underline hover:text-[#071F36]" target="_blank">Datenschutzerklärung</a> zu.
                        </label>
                    </div>

                    <button type="submit" id="nl-submit-btn" class="btn-primary w-full !py-3 mt-4">
                        <span id="nl-btn-text">Jetzt anmelden</span>
                        <span id="nl-btn-loading" class="hidden flex items-center">
                            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            Verarbeite...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // Mobile Menu Logic
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const nav = document.getElementById('navbar');
            menu.classList.toggle('hidden');
        }

        // --- KONFIGURATIONEN ---
        // Werte werden aus config.js geladen (window.KBD_CONFIG)
        const N8N_NEWSLETTER_WEBHOOK = (window.KBD_CONFIG && window.KBD_CONFIG.N8N_NEWSLETTER_WEBHOOK) || '';
        const N8N_CONTACT_WEBHOOK = (window.KBD_CONFIG && window.KBD_CONFIG.N8N_CONTACT_WEBHOOK) || '';
        const N8N_UNSUBSCRIBE_WEBHOOK = (window.KBD_CONFIG && window.KBD_CONFIG.N8N_UNSUBSCRIBE_WEBHOOK) || '';

        // --- UNSUBSCRIBE LOGIC (Abmeldung) ---
        function confirmUnsubscribe() {
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id') || urlParams.get('token'); 

            if (!userId) {
                alert('Es wurde kein Benutzer-Token gefunden. Bitte nutzen Sie den Link aus Ihrer E-Mail.');
                return;
            }

            const btn = document.getElementById('submit-btn');
            const btnText = document.getElementById('btn-text');
            const btnLoading = document.getElementById('btn-loading');

            btn.disabled = true;
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');

            const CONST_WEBHOOK_URL = N8N_UNSUBSCRIBE_WEBHOOK || '';

            if (!CONST_WEBHOOK_URL) {
                alert('Konfigurationsfehler: Webhook-URL nicht gefunden.');
                btn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
                return;
            }

            fetch(CONST_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    id: userId,
                    action: 'unsubscribe',
                    source: 'unsubscribe_page',
                    timestamp: new Date().toISOString()
                }),
            })
            .then(response => {
                if(response.ok) {
                    document.getElementById('confirm-box').classList.add('hidden');
                    document.getElementById('success-message').classList.remove('hidden');
                    document.getElementById('success-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    throw new Error('Server returned error');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Ein technischer Fehler ist aufgetreten.');
                btn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            });
        }

        // --- MODAL LOGIC (Contact & Newsletter) ---
        function toggleModal(id, open) {
            const modal = document.getElementById(id);
            const backdrop = document.getElementById(id.replace('modal', 'backdrop'));
            const content = document.getElementById(id.replace('modal', 'content'));
            
            if(open) {
                // Reset Forms on Open
                if(id === 'contact-modal') {
                    document.getElementById('contact-form').reset();
                    document.getElementById('contact-form-container').classList.remove('hidden');
                    document.getElementById('contact-success').classList.add('hidden');
                }
                if(id === 'newsletter-modal') {
                    document.getElementById('newsletter-form').reset();
                    document.getElementById('newsletter-form').classList.remove('hidden');
                    document.getElementById('newsletter-success').classList.add('hidden');
                }

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                setTimeout(() => { 
                    backdrop.classList.remove('opacity-0'); 
                    content.classList.remove('scale-95', 'opacity-0', 'translate-y-4');
                    content.classList.add('scale-100', 'opacity-100', 'translate-y-0');
                }, 10);
            } else {
                backdrop.classList.add('opacity-0'); 
                content.classList.remove('scale-100', 'opacity-100', 'translate-y-0');
                content.classList.add('scale-95', 'opacity-0', 'translate-y-4');
                setTimeout(() => { 
                    modal.classList.add('hidden'); 
                    document.body.style.overflow = ''; 
                }, 300);
            }
        }

        function openContactModal(e) { if(e) e.preventDefault(); toggleModal('contact-modal', true); }
        function closeContactModal() { toggleModal('contact-modal', false); }
        function openNewsletterModal(e) { if(e) e.preventDefault(); toggleModal('newsletter-modal', true); }
        function closeNewsletterModal() { toggleModal('newsletter-modal', false); }

        // --- CONTACT FORM SUBMIT ---
        async function handleContactFormSubmit(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('contact-submit-btn');
            const btnText = document.getElementById('contact-btn-text');
            const btnLoading = document.getElementById('contact-btn-loading');
            const form = e.target;
            
            if (form.b_address.value !== "") return; // Honeypot

            submitBtn.disabled = true;
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');
            
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch(N8N_CONTACT_WEBHOOK, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ...data, submittedAt: new Date().toISOString(), url: window.location.href, type: 'contact_request_unsubscribe_page' }),
                });

                if (response.ok) {
                    document.getElementById('contact-form-container').classList.add('hidden');
                    document.getElementById('contact-success').classList.remove('hidden');
                } else { throw new Error('Fehler'); }
            } catch (error) {
                console.error(error);
                alert('Fehler bei der Übertragung. Bitte versuchen Sie es später erneut.');
            } finally {
                submitBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }
        }

        // --- NEWSLETTER SUBMIT LOGIC ---
        async function handleNewsletterSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('nl-submit-btn');
            const text = document.getElementById('nl-btn-text');
            const load = document.getElementById('nl-btn-loading');
            const form = e.target;
            const successDiv = document.getElementById('newsletter-success');
            const formDiv = document.getElementById('newsletter-form');

            btn.disabled = true;
            text.classList.add('hidden');
            load.classList.remove('hidden');

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch(N8N_NEWSLETTER_WEBHOOK, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        firstname: data.firstname,
                        lastname: data.lastname,
                        email: data.email,
                        source: 'newsletter_modal_unsubscribe_page',
                        timestamp: new Date().toISOString()
                    })
                });

                if(response.ok) {
                    formDiv.classList.add('hidden');
                    successDiv.classList.remove('hidden');
                } else {
                    throw new Error('API Error');
                }
            } catch (err) {
                console.error(err);
                alert('Ein Fehler ist aufgetreten.');
            } finally {
                btn.disabled = false;
                text.classList.remove('hidden');
                load.classList.add('hidden');
            }
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                if(!document.getElementById('newsletter-modal').classList.contains('hidden')) closeNewsletterModal();
                if(!document.getElementById('contact-modal').classList.contains('hidden')) closeContactModal();
            }
        });
    </script>
</body>
</html>